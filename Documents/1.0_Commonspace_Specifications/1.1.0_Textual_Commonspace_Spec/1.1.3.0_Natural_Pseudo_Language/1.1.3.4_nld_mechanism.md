# NPL 自然语言定义 (NLD) 机制

> 基于： [[1.1.3.1_protocol_overview]], [[1.1.3.2_core_concepts]]

## 1. 引言

为了将自然语言（NL）的灵活性与 NPL 的结构化能力相结合，以简化 ACP 文档和 NPL 库的创建与维护，本文档正式提出 **“自然语言定义” (Natural Language Definition - NLD)** 机制。NLD 提供了一个统一的框架，旨在让开发者能够：

1.  利用 NL 的自然表达力来描述核心的**认知过程**或**概念性数据/对象**。
2.  通过 NPL 的结构化语法来约束其**接口**（名称、输入参数 `Datum` 句柄）和**预期结果的形态**（返回的 `Datum` 句柄应指向何种类型的 `Sign`/`Object`）。

NLD 的目标是实现 NL 和 NPL 的有机融合，充分利用两者的优势。

> 注：仍需完善定义方法。
> 注：NL 和 NPL 依然是泾渭分明的。我不仅希望 NPL 可以表示NL ，也希望在 NL 中可以自然地使用 NPL

## 2. 核心概念：NLD

**自然语言定义 (NLD)** 是一种 NPL 构造，它允许使用自然语言作为**核心指导**，来定义一个需要认知实体（`Cognitor`）通过其内部符号过程（`Semiosis`）来理解和实现的**认知任务**或**概念性数据结构**。其关键在于，NL 的灵活性通过 NPL 的**显式接口定义**和**目标结构约束**得到规整。

NLD 可用于定义两类核心事物：

* **NLD 过程 (NLD Procedure)**: 封装一个**认知过程**或行为。认知实体被指导去理解 NL 描述（主体），并结合输入的 `Datum`（作为约束），执行相应的符号过程，最终可能产生一个指向结果 `Sign`/`Object` 的 `Datum` 句柄。
* **NLD 数据/对象 (NLD Data/Object)**: 利用 NL 来描述一个**概念性的数据结构或对象**（如列表、集合、字典、特定类的实例等）。认知实体被指导去理解 NL 描述，并运用其知识和推理能力，将其“具象化”为一个符合特定目标结构的 `Sign`/`Object`，并返回指向它的 `Datum` 句柄。

## 3. 语法：命名 NLD (用于库和复用)

为了保证 NPL 库定义的可读性和结构性，引入以下 NPL 关键字来定义可复用的、命名的 NLD。

**3.1 定义 NLD 过程 (Procedure)**

```npl
// 使用 nld proc 关键字
// -> 后指定返回的 Datum 应该指向的 Sign/Object 类型
nld proc 过程名称(参数1: TypeHint1, 参数2: TypeHint2 = 默认Datum句柄) -> ReturnTypeHint:
  """
  [必需] 自然语言描述主体：
  这里详细说明认知实体需要执行的认知过程的目标、步骤、关键考量等。
  可以使用 '参数1', '参数2' 等来引用输入的 Datum 句柄所指向的内容。
  示例：分析由 '参数1' 指向的文本 Sign，识别其核心观点，
  并根据 '参数2' 指向的约束条件（例如长度限制），生成一个总结。
  认知实体需要确保返回的 Datum 指向一个符合 'ReturnTypeHint' 描述的 Sign/Object。
  """
  // [可选] 嵌入 NPL 约束或子步骤
  // require_ct_focus(self, focus_area='core_argument_identification')
end_proc // 结束过程定义
```

**3.2 定义 NLD 数据/对象 (Data/Object)**

```npl
// 使用 nld data 关键字
// -> 后指定返回的 Datum 应该指向的 Sign/Object 的结构类型
nld data 数据名称(参数1: TypeHint1 = 默认值) -> TargetStructureHint:
  """
  [必需] 自然语言描述主体：
  描述这个数据或对象的概念内容。认知实体需要理解这段描述，并生成一个
  符合 'TargetStructureHint' 的 Sign/Object。
  示例1：“一个包含'太阳系行星名称'（按距离太阳远近排序）的列表。” -> List
  示例2：“一个代表'颜色代码'的字典，键是颜色名称（字符串），值是十六进制代码（字符串）。” -> Dict
  示例3：（假设存在 NPL 类 'UserProfile'）“一个'UserProfile'对象，其'username'属性根据{{参数1}}设置，'email'属性需要认知实体根据上下文尝试推断。” -> UserProfile
  """
  // [可选] 嵌入 NPL 约束或示例，以提供更强的结构或内容引导
  // constraint name_check = d"名称必须唯一"
end_data // 结束数据定义
```

* **TypeHint / TargetStructureHint**: 用于指示 `Datum` 句柄指向的 `Sign`/`Object` 的预期类型或结构。可以是：
    * 基本概念类型：`String`, `Integer`, `Boolean`, `Float`
    * 集合概念类型：`List`, `Set`, `Dict` (或 `Map`)
    * 已在 NPL 环境中定义的类名：`UserProfile`, `CanvasNode` 等。

**3.3 调用命名 NLD**

调用方式与普通 NPL 函数/方法类似：

```npl
// 调用 NLD 过程
summary_handle = SummarizeText(long_text_datum, constraint_datum)

// 调用 NLD 数据/对象定义
planets_handle = SolarSystemPlanets() // -> 指向一个 List Sign/Object
color_codes_handle = ColorCodeMap()   // -> 指向一个 Dict Sign/Object
```

## 4. 语法：匿名 NLD (用于即时定义)

为了在 NPL 代码中快速、便捷地使用由 NL 定义的过程或数据，提供匿名 NLD 语法：

**4.1 匿名 NLD 过程**

```npl
// 使用 nldp 关键字 (Natural Language Defined Procedure - lambda)
quick_summary = nldp (text: String) -> String : """快速提取 'text' 的首句"""

first_sentence = quick_summary(some_text_datum)

// 也可以直接作为参数传递
processed_text = ApplyProcessing(
  nldp (data: RawData) -> ProcessedData : """对 'data' 执行标准清洗流程""",
  input_data_handle
)
```

**4.2 匿名 NLD 数据/对象**

```npl
// 使用 nldd 关键字 (Natural Language Defined Data - lambda)
// 必须包含类型提示
fruit_list_handle = nldd List : """包含 'apple', 'banana', 'cherry' 的列表"""

// 直接在调用中使用
color_set = GetUniqueItems(nldd Set : """标准 RGB 颜色：red, green, blue""")
```

## 5. 结构/类型提示语法

推荐在 NLD 定义本身中使用 `-> TypeHint` 作为标准方式，来指定其契约。同时，可以提供一个显式的 `NLD.interpret_as(nl_datum_handle, target_type=<TypeHint>)` 指令模式（定义在核心库），用于在 NPL 代码中需要强制将一个已存在的、由 NL 描述的 `Datum` 解释为特定结构时使用，以提供额外的控制和明确性。

## 6. 工作机制：认知实体的解释与执行

NLD 的核心在于其**认知执行模型**：

1.  **接收 NLD 构造/调用**: 认知实体在其 NPL 运行时中处理 NLD 定义或调用。
2.  **理解 NPL 结构**: 解析 NPL 语法部分（关键字、名称、参数签名、`->` 提示）。这些提供了硬性约束。
3.  **理解 NL 主体 (核心)**: 认知实体必须启动其核心的**符号过程（`Semiosis`）**来理解 NL 描述的**意图、内容和需求**。
4.  **执行认知任务**:
    * **对于 NLD 过程**: 基于对 NL 主体的理解，规划并执行一系列内部认知操作。
    * **对于 NLD 数据/对象**: 基于对 NL 主体的理解，在内部构建一个概念性的数据结构或对象表示。
5.  **输出符合结构的 Sign/Object**: 认知实体必须努力使其最终形成的内部解释项（`Interpretant`），在外部化（`Externalization`）为一个 `Sign`/`Object` 时，**严格符合 `->` 提示所指定的类型或结构**。如果 NL 描述与结构提示冲突，应优先满足结构提示，并在 CT 中记录。
6.  **返回 Datum 句柄**: 返回指向新生成的、符合结构的 `Sign`/`Object` 的 `Datum` 句柄。
7.  **强制认知轨迹 (CT)**: 由于 NLD 依赖于对 NL 的理解，其执行过程不确定性较高。因此，**强制要求**认知实体生成**极其详尽**的认知轨迹（`CT`），记录其解释、推理、决策过程，以及如何确保输出符合结构要求。

## 7. 应用：优雅地创建 NPL 库和文档

NLD 机制将显著提升 NPL 生态的开发体验：

* **库定义**: 允许用 NLD 定义核心逻辑，使库结构更清晰。
* **自文档化**: NLD 定义中的 NL 主体本身就是高层描述。
* **降低门槛**: 用更自然的语言定义复杂认知逻辑。
* **提升一致性**: 通过 `->` 提示规范输出结构。

## 8. 结论

自然语言定义 (NLD) 机制通过结构化的方式融合了自然语言的表达力和 NPL 的控制力，为定义可复用的认知过程和数据对象提供了统一框架。它通过强制的接口契约和详尽的认知轨迹要求来管理 NL 的歧义性，有望成为 NPL 语言及其生态发展的关键推动力。